const addItemForm=document.querySelector("#to-do-add"),addItemFormField=document.querySelector("#to-do-add-input"),toDoList=document.querySelector("#to-do-list");let previouslyOpenedMenu=null;const openEl=(()=>{let t=null;return e=>{t?t===e?e&&e.classList.toggle("_opened"):(t.classList.remove("_opened"),e&&e.classList.add("_opened")):e&&e.classList.add("_opened"),t=e}})();function taskState(e,t){t?e.classList.add("_completed"):e.classList.remove("_completed")}function createTask(e,t=!1){return{id:(new Date).getTime(),text:e,completed:t}}function getTasksFromStorage(){var e=localStorage.getItem("tasks");if(e){e=JSON.parse(e);if(null!==e)return e.items||[]}return[]}function setTasksToStorage(e){localStorage.setItem("tasks",JSON.stringify(e))}function expandTasksStorage(e){setTasksToStorage({items:[...getTasksFromStorage(),e]})}function reduceTasksStorage(t){const e=getTasksFromStorage();setTasksToStorage({items:e.filter(e=>e.id!==+t)})}function updateTaskInStorage(d,a){const e=getTasksFromStorage(),o=[];e.forEach(e=>{var t;e.id===+d?(t={...e,...a},o.push(t)):o.push(e)}),setTasksToStorage({items:o})}function renderEditor(t,d,a){const o=document.createElement("div"),s=document.createElement("input"),e=document.createElement("div"),n=document.createElement("button"),c=document.createElement("button");return o.classList.add("to-do-item-editor-area"),s.classList.add("to-do-item-editor-area__input"),e.classList.add("to-do-item-editor-area__controllers"),n.classList.add("text-btn","text-btn_success"),c.classList.add("text-btn","text-btn_danger"),n.textContent="Save",c.textContent="Cancel",s.type="text",s.value=d.textContent,e.append(n,c),o.append(s,e),s.addEventListener("input",e=>{s.value.trim()?n.disabled=!1:n.disabled=!0}),n.addEventListener("click",e=>{d.textContent=s.value,updateTaskInStorage(t,{text:s.value}),o.remove(),a(!0)}),c.addEventListener("click",e=>{o.remove(),a(!0)}),[o,s]}function renderTask(a){const t=document.createElement("li"),e=document.createElement("label"),d=document.createElement("input"),o=document.createElement("span"),s=document.createElement("div"),n=document.createElement("p"),c=document.createElement("div"),i=document.createElement("button"),r=document.createElement("button"),l=document.createElement("button");function m(e){e?(n.classList.remove("_hidden"),r.disabled=!1):(n.classList.add("_hidden"),r.disabled=!0)}return t.classList.add("to-do-item"),e.classList.add("checkbox","to-do-item__item","to-do-item__complete"),d.classList.add("checkbox__input"),o.classList.add("checkbox__circle"),s.classList.add("to-do-item__textbox"),n.classList.add("to-do-item__text"),c.classList.add("to-do-item-controllers"),l.classList.add("btn","btn_details","to-do-item__item","to-do-item__show-more"),i.classList.add("btn","btn_remove","to-do-item__item"),r.classList.add("btn","btn_edit","to-do-item__item"),d.type="checkbox",i.type="button",l.type="button",r.type="button",t.dataset.taskId=a.id,n.textContent=a.text,d.checked=a.completed,taskState(n,a.completed),l.append(document.createElement("span")),e.append(d,o),c.append(r,i),s.append(n),t.append(e,s,c,l),l.addEventListener("click",e=>{openEl(c)}),r.addEventListener("click",e=>{openEl(null),m(!1);const[t,d]=renderEditor(a.id,n,m);s.append(t),d.focus(),d.classList.add("_animate")}),i.addEventListener("click",e=>{i.disabled=!0,reduceTasksStorage(a.id),t.classList.add("_removing"),setTimeout(()=>t.remove(),500)}),d.addEventListener("input",e=>{taskState(n,d.checked),updateTaskInStorage(a.id,{completed:d.checked})}),t}getTasksFromStorage().forEach(e=>{toDoList.append(renderTask(e))}),addItemForm.addEventListener("submit",e=>{e.preventDefault();e=addItemFormField.value.trim();e&&(e=createTask(e),toDoList.append(renderTask(e)),expandTasksStorage(e),addItemFormField.value="")});