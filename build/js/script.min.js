const addItemForm=document.querySelector("#to-do-add"),addItemFormField=document.querySelector("#to-do-add-input"),toDoList=document.querySelector("#to-do-list"),searchInput=document.querySelector("#to-do-search-input");let previouslyOpenedMenu=null;const openEl=(()=>{let t=null;return e=>{t?t===e?e&&e.classList.toggle("_opened"):(t.classList.remove("_opened"),e&&e.classList.add("_opened")):e&&e.classList.add("_opened"),t=e}})();function taskState(e,t){t?e.classList.add("_completed"):e.classList.remove("_completed")}function createTask(e,t=!1){return{id:(new Date).getTime(),text:e,completed:t}}function getTasksFromStorage(){var e=localStorage.getItem("tasks");if(e){e=JSON.parse(e);if(null!==e)return e.items||[]}return[]}function setTasksToStorage(e){localStorage.setItem("tasks",JSON.stringify(e))}function expandTasksStorage(e){setTasksToStorage({items:[...getTasksFromStorage(),e]})}function reduceTasksStorage(t){const e=getTasksFromStorage();setTasksToStorage({items:e.filter(e=>e.id!==+t)})}function updateTaskInStorage(a,d){const e=getTasksFromStorage(),s=[];e.forEach(e=>{var t;e.id===+a?(t={...e,...d},s.push(t)):s.push(e)}),setTasksToStorage({items:s})}function renderEditor(t,a,d){const s=document.createElement("div"),o=document.createElement("input"),e=document.createElement("div"),n=document.createElement("button"),c=document.createElement("button");return s.classList.add("to-do-item-editor-area"),o.classList.add("to-do-item-editor-area__input"),e.classList.add("to-do-item-editor-area__controllers"),n.classList.add("text-btn","text-btn_success"),c.classList.add("text-btn","text-btn_danger"),n.textContent="Save",c.textContent="Cancel",o.type="text",o.value=a.textContent,e.append(n,c),s.append(o,e),o.addEventListener("input",e=>{o.value.trim()?n.disabled=!1:n.disabled=!0}),n.addEventListener("click",e=>{a.textContent=o.value,updateTaskInStorage(t,{text:o.value}),s.remove(),d(!0)}),c.addEventListener("click",e=>{s.remove(),d(!0)}),[s,o]}function renderTask(d){const t=document.createElement("li"),e=document.createElement("label"),a=document.createElement("input"),s=document.createElement("span"),o=document.createElement("div"),n=document.createElement("p"),c=document.createElement("div"),r=document.createElement("button"),i=document.createElement("button"),l=document.createElement("button");function m(e){e?(n.classList.remove("_hidden"),i.disabled=!1):(n.classList.add("_hidden"),i.disabled=!0)}return t.classList.add("to-do-item"),e.classList.add("checkbox","to-do-item__item","to-do-item__complete"),a.classList.add("checkbox__input"),s.classList.add("checkbox__circle"),o.classList.add("to-do-item__textbox"),n.classList.add("to-do-item__text"),c.classList.add("to-do-item-controllers"),l.classList.add("btn","btn_details","to-do-item__item","to-do-item__show-more"),r.classList.add("btn","btn_remove","to-do-item__item"),i.classList.add("btn","btn_edit","to-do-item__item"),a.type="checkbox",r.type="button",l.type="button",i.type="button",t.dataset.taskId=d.id,t.dataset.taskSearchQuery=d.text,n.textContent=d.text,a.checked=d.completed,taskState(n,d.completed),l.append(document.createElement("span")),e.append(a,s),c.append(i,r),o.append(n),t.append(e,o,c,l),l.addEventListener("click",e=>{openEl(c)}),i.addEventListener("click",e=>{openEl(null),m(!1);const[t,a]=renderEditor(d.id,n,m);o.append(t),a.focus(),a.classList.add("_animate")}),r.addEventListener("click",e=>{r.disabled=!0,reduceTasksStorage(d.id),t.classList.add("_removing"),setTimeout(()=>t.remove(),500)}),a.addEventListener("input",e=>{taskState(n,a.checked),updateTaskInStorage(d.id,{completed:a.checked})}),t}getTasksFromStorage().forEach(e=>{toDoList.append(renderTask(e))}),addItemForm.addEventListener("submit",e=>{e.preventDefault();e=addItemFormField.value.trim();e&&(e=createTask(e),toDoList.append(renderTask(e)),expandTasksStorage(e),addItemFormField.value="")}),searchInput.addEventListener("input",e=>{const a=searchInput.value.toLowerCase();document.querySelectorAll("[data-task-id]").forEach(e=>{const t=e.dataset.taskSearchQuery.toLowerCase();t.includes(a)?e.classList.remove("_hidden"):e.classList.add("_hidden")})});